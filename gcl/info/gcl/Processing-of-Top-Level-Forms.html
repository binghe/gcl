<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Processing of Top Level Forms (ANSI and GNU Common Lisp Document)</title>

<meta name="description" content="Processing of Top Level Forms (ANSI and GNU Common Lisp Document)">
<meta name="keywords" content="Processing of Top Level Forms (ANSI and GNU Common Lisp Document)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="File-Compilation.html" rel="up" title="File Compilation">
<link href="Processing-of-Defining-Macros.html" rel="next" title="Processing of Defining Macros">
<link href="File-Compilation.html" rel="prev" title="File Compilation">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<span id="Processing-of-Top-Level-Forms"></span><div class="header">
<p>
Next: <a href="Processing-of-Defining-Macros.html" accesskey="n" rel="next">Processing of Defining Macros</a>, Previous: <a href="File-Compilation.html" accesskey="p" rel="prev">File Compilation</a>, Up: <a href="File-Compilation.html" accesskey="u" rel="up">File Compilation</a> &nbsp; </p>
</div>
<hr>
<span id="Processing-of-Top-Level-Forms-1"></span><h4 class="subsubsection">3.2.3.1 Processing of Top Level Forms</h4>

<p>Processing of <i>top level forms</i> in the file compiler is defined
as follows:
</p>
<dl compact="compact">
<dt>1.</dt>
<dd><p>If the <i>form</i> is a <i>compiler macro form</i>
(not disabled by a <b>notinline</b> <i>declaration</i>),
the <i>implementation</i> might or might not choose to compute
the <i>compiler macro expansion</i> of the <i>form</i> and,
having performed the expansion, might or might not choose to process the result
as a <i>top level form</i> in the same processing mode
(compile-time-too or not-compile-time).
If it declines to obtain or use the expansion, it must process the original <i>form</i>.
</p>
</dd>
<dt>2.</dt>
<dd><p>If the form is a <i>macro form</i>,
its <i>macro expansion</i> is computed and processed as a 
<i>top level form</i> in
the same processing mode (compile-time-too or not-compile-time).
</p>
</dd>
<dt>3.</dt>
<dd><p>If the form is a <b>progn</b> form, each of its
body <i>forms</i> is sequentially processed as a 
<i>top level form</i> in the same processing mode.
</p>
</dd>
<dt>4.</dt>
<dd><p>If the form is a <b>locally</b>, 
<b>macrolet</b>, or <b>symbol-macrolet</b>, 
<b>compile-file</b> establishes the appropriate bindings and processes the
body forms as <i>top level forms</i> with those bindings in effect
in the same processing mode.  (Note that this implies that the lexical
<i>environment</i> in which <i>top level forms</i> are processed
is not necessarily the <i>null lexical environment</i>.)
</p>
</dd>
<dt>5.</dt>
<dd><p>If the form is an <b>eval-when</b>
<span id="index-eval_002dwhen"></span>
 form, it is
handled according to Figure 3&ndash;7.
</p>
<p>plus .5 fil
\offinterlineskip
</p><div class="format">
<pre class="format">  <b>CT</b>   <b>LT</b>   <b>E</b>    <b>Mode</b>  <b>Action</b>    <b>New Mode</b>          <!-- /@w -->
  _________________________________________________<!-- /@w -->
  Yes  Yes  &mdash;  &mdash;   Process   compile-time-too  <!-- /@w -->
  No   Yes  Yes   CTT  Process   compile-time-too  <!-- /@w -->
  No   Yes  Yes   NCT  Process   not-compile-time  <!-- /@w -->
  No   Yes  No   &mdash;   Process   not-compile-time  <!-- /@w -->
  Yes  No   &mdash;  &mdash;   Evaluate  &mdash;               <!-- /@w -->
  No   No   Yes   CTT  Evaluate  &mdash;               <!-- /@w -->
  No   No   Yes   NCT  Discard   &mdash;               <!-- /@w -->
  No   No   No   &mdash;   Discard   &mdash;               <!-- /@w -->
</pre></div>

<p>&nbsp;&nbsp;Figure&nbsp;3&ndash;7:&nbsp;<span class="nolinebreak">EVAL-WHEN</span>&nbsp;processing<!-- /@w -->
</p>
<p>Column <b>CT</b>   indicates whether <tt>:compile-toplevel</tt> is specified.
Column <b>LT</b>   indicates whether <tt>:load-toplevel</tt> is specified.
Column <b>E</b>    indicates whether <tt>:execute</tt> is specified.  
Column <b>Mode</b> indicates the processing mode; 
		a dash (&mdash;) indicates that the processing mode is not relevant.
</p>
<p>The <b>Action</b> column specifies one of three actions:
</p>
<dl compact="compact">
<dt><tt></tt></dt>
<dd><p><b>Process:</b> process the body as <i>top level forms</i> in the
specified mode.
</p>
</dd>
<dt><tt></tt></dt>
<dd><p><b>Evaluate:</b> evaluate the body in the dynamic execution
context of the compiler, using the <i>evaluation environment</i> as
the global environment and the <i>lexical environment</i> in which
the <b>eval-when</b> appears.
</p>
</dd>
<dt><tt></tt></dt>
<dd><p><b>Discard:</b> ignore the <i>form</i>.
</p></dd>
</dl>

<p>The <b>New Mode</b> column indicates the new processing mode. 
A dash (&mdash;) indicates the compiler remains in its current mode.
</p>
</dd>
<dt>6.</dt>
<dd><p>Otherwise, the form is a <i>top level form</i> that
is not one of the special cases.  In compile-time-too mode, the
compiler first evaluates the form in the evaluation 
<i>environment</i> and then minimally compiles it.  In not-compile-time
mode, the <i>form</i> is simply minimally compiled.  All <i>subforms</i>
are treated as <i>non-top-level forms</i>.
</p>
<p>Note that <i>top level forms</i> are processed in the order in
which they textually appear in the file and that each 
<i>top level form</i> read by the compiler is processed before the next is
read.  However, the order of processing (including macro expansion) of
<i>subforms</i> that are not <i>top level forms</i> and the order of
further compilation is unspecified as long as Common Lisp semantics
are preserved.
</p>
</dd>
</dl>

<p><b>eval-when</b> forms cause compile-time evaluation only at
top level.  Both <tt>:compile-toplevel</tt> and <tt>:load-toplevel</tt> situation specifications
are ignored for <i>non-top-level forms</i>. For <i>non-top-level forms</i>, 
an <b>eval-when</b>
specifying the <tt>:execute</tt> situation is treated as an <i>implicit progn</i>
including the <i>forms</i> in the body of the <b>eval-when</b> <i>form</i>;
otherwise, the <i>forms</i> in the body are ignored.
</p>
<hr>
<div class="header">
<p>
Next: <a href="Processing-of-Defining-Macros.html" accesskey="n" rel="next">Processing of Defining Macros</a>, Previous: <a href="File-Compilation.html" accesskey="p" rel="prev">File Compilation</a>, Up: <a href="File-Compilation.html" accesskey="u" rel="up">File Compilation</a> &nbsp; </p>
</div>



</body>
</html>
